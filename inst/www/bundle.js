(()=>{var t={98:function(t,e){var i="undefined"!=typeof self?self:this,n=function(){function t(){this.fetch=!1,this.DOMException=i.DOMException}return t.prototype=i,new t}();!function(t){!function(e){var i="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,o="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,s="ArrayBuffer"in t;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(t){return t&&a.indexOf(Object.prototype.toString.call(t))>-1};function c(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function l(t){return"string"!=typeof t&&(t=String(t)),t}function d(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function u(t){this.map={},t instanceof u?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function p(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function f(t){return new Promise((function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}}))}function y(t){var e=new FileReader,i=f(e);return e.readAsArrayBuffer(t),i}function v(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:o&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:r&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:i&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&o&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=v(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||h(t))?this._bodyArrayBuffer=v(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var t,e,i,n=p(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,i=f(e=new FileReader),e.readAsText(t),i;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),i=new Array(e.length),n=0;n<e.length;n++)i[n]=String.fromCharCode(e[n]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}u.prototype.append=function(t,e){t=c(t),e=l(e);var i=this.map[t];this.map[t]=i?i+", "+e:e},u.prototype.delete=function(t){delete this.map[c(t)]},u.prototype.get=function(t){return t=c(t),this.has(t)?this.map[t]:null},u.prototype.has=function(t){return this.map.hasOwnProperty(c(t))},u.prototype.set=function(t,e){this.map[c(t)]=l(e)},u.prototype.forEach=function(t,e){for(var i in this.map)this.map.hasOwnProperty(i)&&t.call(e,this.map[i],i,this)},u.prototype.keys=function(){var t=[];return this.forEach((function(e,i){t.push(i)})),d(t)},u.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),d(t)},u.prototype.entries=function(){var t=[];return this.forEach((function(e,i){t.push([i,e])})),d(t)},n&&(u.prototype[Symbol.iterator]=u.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(t,e){var i,n,o=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new u(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new u(e.headers)),this.method=(n=(i=e.method||this.method||"GET").toUpperCase(),m.indexOf(n)>-1?n:i),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function w(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),o=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(o))}})),e}function _(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new u(e.headers),this.url=e.url||"",this._initBody(t)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},g.call(b.prototype),g.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},_.error=function(){var t=new _(null,{status:0,statusText:""});return t.type="error",t};var E=[301,302,303,307,308];_.redirect=function(t,e){if(-1===E.indexOf(e))throw new RangeError("Invalid status code");return new _(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var i=Error(t);this.stack=i.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function P(t,i){return new Promise((function(n,r){var s=new b(t,i);if(s.signal&&s.signal.aborted)return r(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function h(){a.abort()}a.onload=function(){var t,e,i={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new u,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var i=t.split(":"),n=i.shift().trim();if(n){var o=i.join(":").trim();e.append(n,o)}})),e)};i.url="responseURL"in a?a.responseURL:i.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;n(new _(o,i))},a.onerror=function(){r(new TypeError("Network request failed"))},a.ontimeout=function(){r(new TypeError("Network request failed"))},a.onabort=function(){r(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&o&&(a.responseType="blob"),s.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),s.signal&&(s.signal.addEventListener("abort",h),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",h)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}P.polyfill=!0,t.fetch||(t.fetch=P,t.Headers=u,t.Request=b,t.Response=_),e.Headers=u,e.Request=b,e.Response=_,e.fetch=P,Object.defineProperty(e,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;(e=o.fetch).default=o.fetch,e.fetch=o.fetch,e.Headers=o.Headers,e.Request=o.Request,e.Response=o.Response,t.exports=e},861:function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((n=n.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.fetch_remove=e.url_remove=e.fetch_plot=e.url_plot=e.fetch_plots=e.url_plots=e.fetch_renderers=e.url_renderers=e.fetch_clear=e.url_clear=e.fetch_info=e.url_info=e.fetch_state=e.url_state=e.new_websocket=e.url_websocket=void 0;const r=o(i(792)),s=i(98),a="http://",h="X-HTTPGD-TOKEN";function c(t){const e=new s.Headers;return t.token&&e.set(h,t.token),e}function l(t,e){return n(this,void 0,void 0,(function*(){const i=yield(0,s.fetch)(e,{headers:c(t)});return yield i.json()}))}function d(t){return"ws://"+t.host}function u(t){return a+t.host+"/state"}function p(t){return a+t.host+"/info"}function f(t){return a+t.host+"/clear"}function y(t){return a+t.host+"/renderers"}function v(t){return a+t.host+"/plots"}function g(t,e,i,n){const o=new URL(a+t.host+"/plot");return e.id&&o.searchParams.append("id",e.id),e.renderer&&o.searchParams.append("renderer",e.renderer),e.width&&o.searchParams.append("width",Math.round(e.width).toString()),e.height&&o.searchParams.append("height",Math.round(e.height).toString()),e.zoom&&o.searchParams.append("zoom",e.zoom.toString()),e.download&&o.searchParams.append("download",e.download),i&&t.token&&o.searchParams.append("token",t.token),n&&o.searchParams.append("c",n),o.href}function m(t,e){const i=new URL(a+t.host+"/remove");return i.searchParams.append("id",e.id),i.href}e.url_websocket=d,e.new_websocket=function(t){return new r.default(d(t))},e.url_state=u,e.fetch_state=function(t){return l(t,u(t))},e.url_info=p,e.fetch_info=function(t){return l(t,p(t))},e.url_clear=f,e.fetch_clear=function(t){return l(t,f(t))},e.url_renderers=y,e.fetch_renderers=function(t){return l(t,y(t))},e.url_plots=v,e.fetch_plots=function(t){return l(t,v(t))},e.url_plot=g,e.fetch_plot=function(t,e){return(0,s.fetch)(g(t,e),{headers:c(t)})},e.url_remove=m,e.fetch_remove=function(t,e){return l(t,m(t,e))}},485:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.HttpgdConnection=void 0;const s=r(i(861)),a=i(215);class h{constructor(t,e){this.mode=0,this.pausePoll=!1,this.disconnected=!1,this.remoteStateChanged=new a.StateChangeListener,this.connectionChanged=new a.StateChangeListener,this.backend=t,this.allowWebsockets=e||!1}open(){0==this.mode&&this.start(3)}close(){0!=this.mode&&this.start(0)}start(t){if(this.mode!=t)switch(t){case 1:this.clearWebsocket(),this.clearPoll(),this.pollHandle=setInterval((()=>this.poll()),h.INTERVAL_POLL),this.mode=t;break;case 2:this.clearWebsocket(),this.clearPoll(),this.pollHandle=setInterval((()=>this.poll()),h.INTERVAL_POLL_SLOW),this.mode=t;break;case 3:if(!this.allowWebsockets){this.start(1);break}this.clearPoll(),this.clearWebsocket(),this.socket=s.new_websocket(this.backend),this.socket.onmessage=t=>this.onWsMessage(t.data.toString()),this.socket.onopen=()=>this.onWsOpen(),this.socket.onclose=()=>this.onWsClose(),this.socket.onerror=()=>this.start(2),this.mode=t,this.poll();break;case 0:this.clearWebsocket(),this.clearPoll(),this.mode=t}}clearPoll(){this.pollHandle&&clearInterval(this.pollHandle)}clearWebsocket(){this.socket&&(this.socket.onclose=()=>{},this.socket.close())}poll(){this.pausePoll||s.fetch_state(this.backend).catch((t=>{throw t})).then((t=>{this.setDisconnected(!1),2===this.mode&&this.start(3),this.pausePoll||this.checkState(t)})).catch((()=>{this.setDisconnected(!0),2!==this.mode&&this.start(2)}))}onWsMessage(t){if(t.startsWith("{")){const e=JSON.parse(t);this.checkState(e)}else console.log("Unknown WS message: "+t)}onWsClose(){this.setDisconnected(!0)}onWsOpen(){this.setDisconnected(!1)}setDisconnected(t){this.disconnected!=t&&(this.disconnected=t,this.disconnected?this.start(2):this.start(3),this.connectionChanged.notify(t))}checkState(t){this.lastState&&this.lastState.active===t.active&&this.lastState.hsize===t.hsize&&this.lastState.upid===t.upid||(this.lastState=t,this.remoteStateChanged.notify(t))}onRemoteChanged(t){this.remoteStateChanged.subscribe(t)}onConnectionChanged(t){this.connectionChanged.subscribe(t)}}e.HttpgdConnection=h,h.INTERVAL_POLL=500,h.INTERVAL_POLL_SLOW=15e3},774:function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Httpgd=void 0;const o=i(861),r=i(485),s=i(215);e.Httpgd=class{constructor(t,e,i){this.plotsChanged=new s.StateChangeListener,this.deviceActiveChanged=new s.StateChangeListener,this.data={},this.backend={host:t,token:e},this.connection=new r.HttpgdConnection(this.backend,i),this.connection.onRemoteChanged(((t,e)=>this.remoteStateChanged(t,e)))}connect(){return this.connection.open(),this.updateInfo()}disconnect(){this.connection.close()}onConnectionChanged(t){this.connection.onConnectionChanged(t)}remoteStateChanged(t,e){e&&e.hsize===t.hsize&&e.upid===t.upid||this.updatePlots(),e&&e.active==t.active||this.deviceActiveChanged.notify(t.active)}localStateChanged(t){var e;this.remoteStateChanged(t,null===(e=this.data.plots)||void 0===e?void 0:e.state)}updateInfo(){return n(this,void 0,void 0,(function*(){const t=(0,o.fetch_info)(this.backend),e=(0,o.fetch_renderers)(this.backend);this.data.info=yield t,this.data.renderers=yield e}))}updatePlots(){return n(this,void 0,void 0,(function*(){const t=yield(0,o.fetch_plots)(this.backend);this.data.plots=t,this.plotsChanged.notify(t)}))}getPlots(){return this.data.plots?this.data.plots.plots:[]}getInfo(){var t;return null===(t=this.data)||void 0===t?void 0:t.info}getRenderers(){return this.data.renderers?this.data.renderers.renderers:[]}getPlotURL(t){return this.data.plots?(0,o.url_plot)(this.backend,t,!0,this.data.plots.state.upid.toString()):void 0}getPlot(t){return this.data.plots?(0,o.fetch_plot)(this.backend,t):void 0}onPlotsChanged(t){this.plotsChanged.subscribe(t)}onDeviceActiveChanged(t){this.deviceActiveChanged.subscribe(t)}removePlot(t){return n(this,void 0,void 0,(function*(){const e=yield(0,o.fetch_remove)(this.backend,t);return this.localStateChanged(e)}))}clearPlots(){return n(this,void 0,void 0,(function*(){const t=yield(0,o.fetch_clear)(this.backend);return this.localStateChanged(t)}))}}},215:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StateChangeListener=void 0,e.StateChangeListener=class{constructor(){this.fun=[]}notify(t){for(let e=0;e<this.fun.length;++e)this.fun[e](t,this.oldState);this.oldState=t}subscribe(t){this.fun.push(t)}}},792:(t,e,i)=>{var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:void 0!==i.g?n=i.g.WebSocket||i.g.MozWebSocket:"undefined"!=typeof window?n=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),t.exports=n},900:(t,e,i)=>{"use strict";t.exports=i.p+"18c7a89e30a180cb.svg"}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&!t;)t=n[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{"use strict";var t=i(774),e=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((n=n.apply(t,e||[])).next())}))},n=function(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(h){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(i=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}};function o(t){var e=document.getElementById(t);if(!e)throw new ReferenceError(t+" is not defined");return e}function r(t,e,i){var n=document.createElement("a");n.href=t,e&&(n.download=e),i&&(n.target="_blank"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function s(t,e){var i=document.createElement("canvas");i.style.display="none",document.body.appendChild(i);var n=t.getBoundingClientRect();i.width=n.width,i.height=n.height;var o=i.getContext("2d");o&&(o.drawImage(t,0,0,i.width,i.height),e(i).finally((function(){return document.body.removeChild(i)})))}function a(t,e,i){var n=t.value;if(!n.match(/^\d+$/))return!1;var o=parseInt(n);return o>=e&&o<=i}function h(t,e,i){return e?t.classList.add(i):t.classList.remove(i),e}var c="scrollBehavior"in document.documentElement.style,l=i(900),d=function(){function t(t){var e=this;this.viewer=t,this.elemModal=o("exp-modal"),this.imgPreview=o("exp-image"),this.inputWidth=o("ie-width"),this.inputHeight=o("ie-height"),this.inputZoom=o("ie-scale"),this.btnOpen=o("ie-btn-open"),this.btnDownload=o("ie-btn-download"),this.selectFormat=o("ie-format"),this.btnClose=o("exp-modal-close"),this.btnClose.onclick=function(){return e.hide()},window.onmousedown=function(t){t.target==e.elemModal&&e.hide()},this.inputWidth.addEventListener("input",(function(){return e.update()})),this.inputHeight.addEventListener("input",(function(){return e.update()})),this.inputZoom.addEventListener("input",(function(){return e.update()})),this.btnDownload.onclick=function(){return e.clickDownload()},this.btnOpen.onclick=function(){return e.clickOpen()}}return t.prototype.initRenderers=function(){var t=this;this.renderers=this.viewer.httpgd.getRenderers(),this.renderers.sort((function(t,e){return function(t,e){return t<e?-1:t>e?1:0}(t.name,e.name)})).forEach((function(e){var i=document.createElement("option");i.value=e.id,i.text=e.name+" (*"+e.ext+")",i.title=e.descr,t.selectFormat.add(i)})),this.selectFormat.value="svg"},t.prototype.hide=function(){this.elemModal.style.display="none"},t.prototype.isVisible=function(){return this.elemModal.style.display&&"none"!==this.elemModal.style.display},t.prototype.validWidth=function(){return a(this.inputWidth,t.MIN_PREVIEW_SIZE,t.MAX_PREVIEW_SIZE)},t.prototype.getWidth=function(){return Math.min(parseInt(this.inputWidth.value),t.MAX_PREVIEW_SIZE)},t.prototype.validHeight=function(){return a(this.inputHeight,t.MIN_PREVIEW_SIZE,t.MAX_PREVIEW_SIZE)},t.prototype.getHeight=function(){return Math.min(parseInt(this.inputHeight.value),t.MAX_PREVIEW_SIZE)},t.prototype.validZoom=function(){return a(this.inputZoom,t.MIN_PREVIEW_ZOOM,t.MAX_PREVIEW_ZOOM)},t.prototype.getZoom=function(){return Math.max(parseInt(this.inputZoom.value)/100,t.MIN_PREVIEW_ZOOM)},t.prototype.getRenderer=function(){var t=this;return this.viewer.httpgd.getRenderers().find((function(e){return e.id==t.selectFormat.value}))},t.prototype.clickDownload=function(){var t=this.viewer.plotView.getCurrentPlotId();if(t){var e=this.getRenderer();r(this.viewer.httpgd.getPlotURL({width:this.getWidth(),height:this.getHeight(),zoom:this.getZoom(),id:t,renderer:e.id,download:"plot_"+t+e.ext}))}},t.prototype.clickOpen=function(){var t=this.viewer.plotView.getCurrentPlotId();if(t){var e=this.getRenderer();r(this.viewer.httpgd.getPlotURL({width:this.getWidth(),height:this.getHeight(),zoom:this.getZoom(),id:t,renderer:e.id}),null,!0)}},t.prototype.update=function(){if(!(h(this.inputWidth,!this.validWidth(),"invalid-input")||h(this.inputHeight,!this.validHeight(),"invalid-input")||h(this.inputZoom,!this.validZoom(),"invalid-input"))){var t=this.viewer.plotView.getCurrentPlotId();if(t){var e=this.viewer.httpgd.getPlotURL({width:this.getWidth(),height:this.getHeight(),zoom:this.getZoom(),id:t});this.imgPreview.src=e}else this.imgPreview.src=l}},t.prototype.show=function(){this.elemModal.style.display="block",this.update()},t.MIN_PREVIEW_SIZE=1,t.MAX_PREVIEW_SIZE=1e4,t.MIN_PREVIEW_ZOOM=.01,t.MAX_PREVIEW_ZOOM=1e4,t}(),u=function(){function t(t){this.viewer=t,this.overlayContainer=o("overlay"),this.overlayText=o("overlay-text")}return t.prototype.show=function(t){this.overlayText.innerText=t,this.overlayContainer.style.display="inline"},t.prototype.hide=function(){this.overlayContainer.style.display="none"},t.TEXT_CONNECTION_LOST="Connection lost.",t.TEXT_DEVICE_INACTIVE="Device inactive.",t}(),p=function(){function t(e){var i=this;this.viewer=e,this.dropdown=o("tb-more").parentElement,this.dropdown.onmouseenter=function(){return i.showDropdown()},this.dropdown.onmouseleave=function(){return i.hideDropdown()},this.zoomLabel=o("tb-zlvl"),this.pageLabel=o("tb-pnum"),this.elemToolbar=o("toolbar"),this.elemContainer=o("container"),this.timoutFade=setTimeout((function(){return i.fadeOut()}),t.DELAY_FADE_OUT),this.elemContainer.onmousemove=function(){i.elemToolbar.classList.remove("fade-out"),clearTimeout(i.timoutFade),i.timoutFade=setTimeout((function(){return i.fadeOut()}),t.DELAY_FADE_OUT)},this.elemContainer.onmouseleave=function(){return i.fadeOut()}}return t.prototype.registerActions=function(t){for(var e=this,i={},n=function(t){if(o(t.id).onclick=function(){t.f(),e.hideDropdown()},t.keys)for(var n=0,r=t.keys;n<r.length;n++){var s=r[n];i[s]=t}},r=0,s=t;r<s.length;r++)n(s[r]);window.addEventListener("keydown",(function(t){if(!e.viewer.exportView.isVisible()){var n=i[t.keyCode];return!n||n.altKey&&!t.altKey?void 0:(n.f(),void t.preventDefault())}}))},t.prototype.showDropdown=function(){this.dropdown.classList.add(t.CSS_SHOW_DROPDOWN)},t.prototype.hideDropdown=function(){this.dropdown.classList.remove(t.CSS_SHOW_DROPDOWN)},t.prototype.setZoomLabelText=function(t){this.zoomLabel.childNodes[0].nodeValue=t},t.prototype.setPageLabelText=function(t){this.pageLabel.childNodes[0].nodeValue=t},t.prototype.fadeOut=function(){this.elemToolbar.classList.add("fade-out")},t.DELAY_FADE_OUT=4e3,t.CSS_SHOW_DROPDOWN="drop-open",t}(),f=function(){function t(t,e){var i=this;this.viewer=t,this.elemPlotView=o("plotview"),this.elemSidebar=o("sidebar"),e&&(this.elemSidebar.classList.add("notransition","nohist"),this.elemPlotView.classList.add("notransition","nohist"),setTimeout((function(){i.elemSidebar.classList.remove("notransition"),i.elemPlotView.classList.remove("notransition")}),300))}return t.prototype.update=function(t){for(var e=this,i=0;i<this.elemSidebar.children.length;)i>=t.plots.length||this.elemSidebar.children[i].getAttribute("data-pid")!==t.plots[i].id?this.elemSidebar.removeChild(this.elemSidebar.children[i]):i++;for(var n=function(){var n=t.plots[i],r=document.createElement("div");r.setAttribute("data-pid",n.id);var s=document.createElement("a");s.innerHTML="&#10006;",s.onclick=function(){e.viewer.httpgd.removePlot({id:n.id}),e.viewer.httpgd.updatePlots()};var a=document.createElement("img");r.classList.add("history-item"),a.setAttribute("src",o.viewer.httpgd.getPlotURL({id:n.id})),r.onclick=function(){return e.viewer.plotView.setPage(n.id)},r.appendChild(a),r.appendChild(s),o.elemSidebar.appendChild(r)},o=this;i<t.plots.length;++i)n()},t.prototype.setSelected=function(t){for(var e,i,n,o=0;o<this.elemSidebar.children.length;++o){var r=this.elemSidebar.children[o];r.getAttribute("data-pid")===t?(r.classList.add("history-selected"),e=r):r.classList.remove("history-selected")}if(e){var s=e.getBoundingClientRect(),a=s.y+this.elemSidebar.scrollTop,h=s.height,l=a-(this.elemSidebar.getBoundingClientRect().height/2-h/2);i=this.elemSidebar,n={top:l,behavior:"smooth"},c?i.scrollTo(n):i.scrollTo(n.left?n.left:0,n.top?n.top:0)}},t.prototype.toggle=function(){var t=this;this.elemSidebar.classList.toggle("nohist"),this.elemPlotView.classList.toggle("nohist"),setTimeout((function(){return t.viewer.plotView.update()}),300)},t.prototype.hideWithoutAnimation=function(){var t=this;this.elemSidebar.classList.add("notransition","nohist"),this.elemPlotView.classList.add("notransition","nohist"),this.viewer.plotView.update(),setTimeout((function(){t.elemSidebar.classList.remove("notransition"),t.elemPlotView.classList.remove("notransition")}),300)},t}(),y=function(){function t(e,i){var n=this;this.resizeBlocked=!1,this.scale=t.SCALE_DEFAULT,this.page=1,this.viewer=e,this.toolbar=new p(e),this.sidebar=new f(e,i),this.image=o("drawing"),this.image.src=l,window.addEventListener("resize",(function(){return n.resize()}))}return t.prototype.updatePlots=function(t){this.plots=t,this.page=t.plots.length,this.updatePageLabel(),this.sidebar.update(t)},t.prototype.getCurrentPlotId=function(){if(!this.plots||0==this.plots.plots.length)return null;for(;this.page<1;)this.page+=this.plots.plots.length;for(;this.page>this.plots.plots.length;)this.page-=this.plots.plots.length;return this.plots.plots[this.page-1].id},t.prototype.update=function(){if(this.plots&&0!=this.plots.plots.length){var t=this.getCurrentPlotId(),e=this.image.getBoundingClientRect(),i=this.viewer.httpgd.getPlotURL({id:t,width:e.width,height:e.height,zoom:this.scale});i&&(this.image.src=i),this.updatePageLabel(),this.sidebar.setSelected(t)}else this.image.src=l},t.prototype.resize=function(){var e=this;this.resizeBlocked||(this.resizeBlocked=!0,setTimeout((function(){e.update(),e.resizeBlocked=!1}),t.COOLDOWN_RESIZE))},t.prototype.zoomOut=function(){this.scale-t.SCALE_STEP>t.SCALE_MIN&&(this.scale-=t.SCALE_STEP),this.updateZoomLabel(),this.resize()},t.prototype.zoomIn=function(){this.scale+=t.SCALE_STEP,this.updateZoomLabel(),this.resize()},t.prototype.zoomReset=function(){this.scale=t.SCALE_DEFAULT,this.updateZoomLabel(),this.resize()},t.prototype.getZoomString=function(){return Math.ceil(this.scale/t.SCALE_DEFAULT*100)+"%"},t.prototype.updateZoomLabel=function(){this.toolbar.setZoomLabelText(this.getZoomString())},t.prototype.nextPage=function(){this.page++,this.update()},t.prototype.prevPage=function(){this.page--,this.update()},t.prototype.newestPage=function(){this.plots&&this.page!=this.plots.plots.length&&(this.page=this.plots.plots.length,this.update())},t.prototype.setPage=function(t){if(this.plots)for(var e=0;e<this.plots.plots.length;++e)if(this.plots.plots[e].id===t)return this.page=e+1,void this.update()},t.prototype.getPageString=function(){return this.plots?this.page+"/"+this.plots.plots.length:"0/0"},t.prototype.updatePageLabel=function(){this.toolbar.setPageLabelText(this.getPageString())},t.prototype.downloadSVG=function(){var t;t=this.image,fetch(t.src).then((function(t){return t.blob()})).then((function(t){r(URL.createObjectURL(t),"plot.svg")}))},t.prototype.downloadPNG=function(){!function(t,i){var o=this;s(t,(function(t){return e(o,void 0,void 0,(function(){return n(this,(function(e){return r(t.toDataURL("image/png").replace("image/png","image/octet-stream"),"plot.png"),[2]}))}))}))}(this.image)},t.prototype.copyPNG=function(){!function(t){var i,o=this;(null===(i=navigator.clipboard)||void 0===i?void 0:i.write)?s(t,(function(t){return e(o,void 0,void 0,(function(){var e;return n(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(e){return t.toBlob(e)}))];case 1:return(e=i.sent())?[4,navigator.clipboard.write([new ClipboardItem(Object.defineProperty({},e.type,{value:e,enumerable:!0}))])]:[2];case 2:return[2,i.sent()]}}))}))})):console.warn("No clipboard API support!")}(this.image)},t.prototype.removePlot=function(){this.viewer.httpgd.removePlot({id:this.getCurrentPlotId()})},t.prototype.clearPlots=function(){this.viewer.httpgd.clearPlots()},t.COOLDOWN_RESIZE=200,t.SCALE_DEFAULT=1.25,t.SCALE_STEP=t.SCALE_DEFAULT/12,t.SCALE_MIN=.5,t}(),v=function(){function e(e,i,n,o){var r=this;this.sidebarHidden=!1,this.httpgd=new t.Httpgd(e,i,n),o&&(this.sidebarHidden=!0),this.httpgd.onPlotsChanged((function(t){return r.plotsChanged(t)})),this.httpgd.onConnectionChanged((function(t){return r.connectionChanged(t)})),this.httpgd.onDeviceActiveChanged((function(t){return r.deviceActiveChanged(t)}))}return e.prototype.plotsChanged=function(t){var e,i;null===(e=this.plotView)||void 0===e||e.updatePlots(t),null===(i=this.plotView)||void 0===i||i.update()},e.prototype.connectionChanged=function(t){var e,i;t?null===(e=this.overlayView)||void 0===e||e.show(u.TEXT_CONNECTION_LOST):null===(i=this.overlayView)||void 0===i||i.hide()},e.prototype.deviceActiveChanged=function(t){var i,n=this;this.deviceInactiveDelayed&&clearTimeout(this.deviceInactiveDelayed),t?null===(i=this.overlayView)||void 0===i||i.hide():this.deviceInactiveDelayed=setTimeout((function(){var t;return null===(t=n.overlayView)||void 0===t?void 0:t.show(u.TEXT_DEVICE_INACTIVE)}),e.COOLDOWN_DEVICE_INACTIVE)},e.prototype.init=function(){var t=this;this.plotView=new y(this,this.sidebarHidden),this.overlayView=new u(this),this.exportView=new d(this),this.httpgd.connect().then((function(){console.log("Connected to httpgd "+t.httpgd.getInfo().version.httpgd),t.exportView.initRenderers()})),this.plotView.toolbar.registerActions([{keys:[37,40],f:function(){return t.plotView.prevPage()},id:"tb-left"},{keys:[39,38],f:function(){return t.plotView.nextPage()},id:"tb-right"},{keys:[78],f:function(){return t.plotView.newestPage()},id:"tb-pnum"},{keys:[187],f:function(){return t.plotView.zoomIn()},id:"tb-plus"},{keys:[189],f:function(){return t.plotView.zoomOut()},id:"tb-minus"},{keys:[48],f:function(){return t.plotView.zoomReset()},id:"tb-zlvl"},{id:"tb-clear",altKey:!0,keys:[68],f:function(){return t.plotView.clearPlots()}},{id:"tb-remove",keys:[46,68],f:function(){return t.plotView.removePlot()}},{id:"tb-save-svg",keys:[83],f:function(){return t.plotView.downloadSVG()}},{id:"tb-save-png",keys:[80],f:function(){return t.plotView.downloadPNG()}},{id:"tb-copy-png",keys:[67],f:function(){return t.plotView.copyPNG()}},{id:"tb-history",keys:[72],f:function(){return t.plotView.sidebar.toggle()}},{id:"tb-export",keys:[69],f:function(){return t.exportView.show()}}])},e.COOLDOWN_DEVICE_INACTIVE=1e3,e}(),g=new URL(window.location.href).searchParams;const m={viewer:new v(g.get("hgd")||g.get("host")||window.location.host,g.get("token")||void 0,!g.has("ws")||"0"!=g.get("ws"),!!g.has("sidebar")&&"0"==g.get("sidebar"))};window.onload=function(){m.viewer.init()}})()})();